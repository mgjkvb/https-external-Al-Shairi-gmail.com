<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙƒØ´Ù Ø§Ù„Ø¹Ù…Ù„ - ÙØ±Ø²Ø§ØªØ´ÙŠ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ©</title>
<style>
body { font-family: "Cairo", sans-serif; background: #fdfbf8; color: #333; margin:0; padding:0; text-align:center; }
header { background: black; color: gold; padding:15px; font-size:1.5em; font-weight:bold; }
.container { padding:20px; max-width:1000px; margin:auto; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ccc; padding:10px; }
th { background:black; color:gold; }
button { background:black; color:gold; border:none; padding:8px 15px; border-radius:6px; cursor:pointer; margin:5px; }
button:hover { background:gold; color:black; }
input, select, textarea { padding:8px; border:1px solid #ccc; border-radius:6px; }
#summary { margin-top:20px; font-size:1.2em; font-weight:bold; text-align:right; }
@media print { .no-print { display:none; } header { color:black; background:none; } }
</style>
</head>
<body>
<header>ÙØ±Ø²Ø§ØªØ´ÙŠ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ© - ÙƒØ´Ù Ø§Ù„Ø¹Ù…Ù„</header>

<div class="container">
<div class="no-print">
<input type="date" id="date">
<select id="size">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
<option>26</option><option>28</option><option>30</option><option>32</option><option>34</option>
<option>36</option><option>38</option><option>40</option><option>42</option><option>44</option>
<option>46</option><option>48</option><option>50</option>
</select>
<input type="number" id="count" placeholder="Ø§Ù„Ø¹Ø¯Ø¯">
<textarea id="note" placeholder="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
<br>
<button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ©</button>
<button onclick="saveData()">ğŸ’¾ Ø­ÙØ¸</button>
<button onclick="printFiltered()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ</button>
<button onclick="printFullTable()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØ§Ù…Ù„</button>
<button onclick="generatePDF()">ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© PDF</button>
<button onclick="sendWhatsAppPDFText()">ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„ ÙØ§ØªÙˆØ±Ø© PDF + Ù†Øµ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
<br><br>
<label>ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…: </label>
<input type="date" id="filterDate" onchange="applyFilters()">
<label>ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹: </label>
<select id="filterType" onchange="applyFilters()">
<option value="">Ø§Ù„ÙƒÙ„</option>
<option>26</option><option>28</option><option>30</option><option>32</option><option>34</option>
<option>36</option><option>38</option><option>40</option><option>42</option><option>44</option>
<option>46</option><option>48</option><option>50</option>
</select>
</div>

<table id="workTable">
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
<th>Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ù†ÙˆØ¹</th>
<th>Ø§Ù„Ø¹Ø¯Ø¯</th>
<th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
<th class="no-print">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="summary">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯: 0</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
let table = document.querySelector("#workTable tbody");
let lastInvoice = Number(localStorage.getItem("lastInvoice") || 0);

function addRow() {
  let date = document.getElementById("date").value;
  let size = document.getElementById("size").value;
  let count = document.getElementById("count").value;
  let note = document.getElementById("note").value;
  if (!date || !size || !count) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©."); return; }
  lastInvoice +=1; localStorage.setItem("lastInvoice", lastInvoice);
  let row = document.createElement("tr");
  row.innerHTML = `<td>${lastInvoice}</td><td>${date}</td><td>${size}</td><td>${count}</td><td>${note}</td>
  <td class="no-print"><button onclick="editRow(this)">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="deleteRow(this)">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>`;
  table.appendChild(row);
  clearFields(); saveData(); updateSummary();
}

function clearFields() {
  document.getElementById("date").value=""; document.getElementById("size").value=""; document.getElementById("count").value=""; document.getElementById("note").value="";
}

function editRow(btn) {
  let password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:"); if(password!=="1234"){alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!"); return;}
  let row=btn.parentElement.parentElement;
  document.getElementById("date").value=row.children[1].textContent;
  document.getElementById("size").value=row.children[2].textContent;
  document.getElementById("count").value=row.children[3].textContent;
  document.getElementById("note").value=row.children[4].textContent;
  row.remove(); saveData(); updateSummary();
}

function deleteRow(btn) {
  let password = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø­Ø°Ù:"); if(password!=="1234"){alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!"); return;}
  btn.parentElement.parentElement.remove(); saveData(); updateSummary();
}

function saveData() {
  let rows=[]; table.querySelectorAll("tr").forEach(r=>{
    rows.push({invoice:r.children[0].textContent,date:r.children[1].textContent,size:r.children[2].textContent,count:r.children[3].textContent,note:r.children[4].textContent});
  });
  localStorage.setItem("workData", JSON.stringify(rows));
}

function loadData() {
  let data = JSON.parse(localStorage.getItem("workData") || "[]");
  data.forEach(d=>{
    let row=document.createElement("tr");
    row.innerHTML=`<td>${d.invoice}</td><td>${d.date}</td><td>${d.size}</td><td>${d.count}</td><td>${d.note}</td>
    <td class="no-print"><button onclick="editRow(this)">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="deleteRow(this)">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>`;
    table.appendChild(row);
  });
  if(data.length>0){lastInvoice=Math.max(...data.map(d=>Number(d.invoice))); localStorage.setItem("lastInvoice",lastInvoice);}
  updateSummary();
}
loadData();

function updateSummary(){
  let total=0;
  table.querySelectorAll("tr").forEach(r=>total+=Number(r.children[3].textContent||0));
  document.getElementById("summary").textContent=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯: ${total}`;
}

function applyFilters(){
  let filterDate=document.getElementById("filterDate").value;
  let filterType=document.getElementById("filterType").value;
  table.querySelectorAll("tr").forEach(r=>{
    let show=true;
    if(filterDate && r.children[1].textContent!==filterDate) show=false;
    if(filterType && r.children[2].textContent!==filterType) show=false;
    r.style.display=show?"":"none";
  });
}

function printFiltered(){ applyFilters(); window.print(); }

function printFullTable(){
  table.querySelectorAll("tr").forEach(r=>r.style.display=""); // Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ
  window.print();
}

function generatePDF() {
  applyFilters();
  let container = document.createElement('div');
  let header = document.createElement('h2');
  header.textContent = "ÙØ±Ø²Ø§ØªØ´ÙŠ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ© - ÙØ§ØªÙˆØ±Ø© Ø¹Ù…Ù„";
  header.style.textAlign = "center";
  container.appendChild(header);
  
  let tableClone = document.getElementById("workTable").cloneNode(true);
  tableClone.querySelectorAll(".no-print").forEach(el => el.remove());
  container.appendChild(tableClone);
  
  let totalDiv = document.createElement('div');
  totalDiv.textContent = document.getElementById("summary").textContent;
  totalDiv.style.textAlign = "right"; totalDiv.style.fontWeight = "bold"; totalDiv.style.marginTop = "10px";
  container.appendChild(totalDiv);
  
  html2pdf().from(container).save("ÙØ§ØªÙˆØ±Ø©_ÙØ±Ø²Ø§ØªØ´ÙŠ.pdf");
}

function sendWhatsAppPDFText() {
  generatePDF();
  applyFilters();
  
  let rows=[];
  let totalCount=0;
  table.querySelectorAll("tr").forEach(r=>{
    if(r.style.display!=="none"){
      rows.push(`|${r.children[0].textContent}|${r.children[1].textContent}|${r.children[2].textContent}|${r.children[3].textContent}|${r.children[4].textContent}|`);
      totalCount+=Number(r.children[3].textContent||0);
    }
  });
  
  if(rows.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„."); return; }
  
  let header = "ÙØ±Ø²Ø§ØªØ´ÙŠ Ù„Ù„Ø®ÙŠØ§Ø·Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠØ© - ÙØ§ØªÙˆØ±Ø© Ø¹Ù…Ù„\n\n";
  let tableHeader = "|Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©|Ø§Ù„ØªØ§Ø±ÙŠØ®|Ø§Ù„Ù†ÙˆØ¹|Ø§Ù„Ø¹Ø¯Ø¯|Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª|\n";
  let separator = "--------------------------------------\n";
  let messageText = header + tableHeader + separator + rows.join("\n") + "\n\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯: " + totalCount + "\n\nÙ…Ù„Ù PDF ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†Ø²ÙŠÙ„Ù‡ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡ Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.";
  
  let phone = "774353110";
  let message = encodeURIComponent(messageText);
  window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
  alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF ÙˆÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.");
}
</script>
</body>
</html>
